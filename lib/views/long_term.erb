<!DOCTYPE html>
<html>
  <head>
    <title>The Donald Monitor</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/d3js/3.5.17/d3.min.js" charset="utf-8"></script>
    <script src="//cdn.jsdelivr.net/npm/taucharts@1/build/production/tauCharts.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/taucharts@1/build/production/tauCharts.min.css">
    <style>
    .c {
    width: 540px;
    height: 180px;
    margin: 0;
    padding: 0;
    float: left;
    }
    .chart{
      height: 360px;
    }
    </style>
    <script>
      var days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
      var shortDays = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
      var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      var shortMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

      function zeropad(n) {
          return n > 9 ? String(n) : "0" + String(n);
      }

      function twelveHour(t) {
          var hour = t.getHours() % 12;
          return hour === 0 ? 12 : hour;
      }

      var strftimeCallbacks = {
          // Short day name (Sun-Sat)
          a: function (t) { return shortDays[t.getDay()]; },
          // Long day name (Sunday-Saturday)
          A: function (t) { return days[t.getDay()]; },
          // Short month name (Jan-Dec)
          b: function (t) { return shortMonths[t.getMonth()]; },
          // Long month name (January-December)
          B: function (t) { return months[t.getMonth()]; },
          // String representation (Thu Dec 23 2010 11:48:54 GMT-0800 (PST))
          c: function (t) { return t.toString(); },
          // Two-digit day of the month (01-31)
          d: function (t) { return zeropad(t.getDate()); },
          // Day of the month (1-31)
          D: function (t) { return String(t.getDate()); },
          // Two digit hour in 24-hour format (00-23)
          H: function (t) { return zeropad(t.getHours()); },
          // Hour in 24-hour format (0-23)
          i: function (t) { return String(t.getHours()); },
          // Two digit hour in 12-hour format (01-12)
          I: function (t) { return zeropad(twelveHour(t)); },
          // Hour in 12-hour format (1-12)
          l: function (t) { return String(twelveHour(t)); },
          // Two digit month (01-12)
          m: function (t) { return zeropad(t.getMonth() + 1); },
          // Two digit minutes (00-59)
          M: function (t) { return zeropad(t.getMinutes()); },
          // am or pm
          p: function (t) { return t.getHours() < 12 ? "am" : "pm"; },
          // AM or PM
          P: function (t) { return t.getHours() < 12 ? "AM" : "PM"; },
          // Two digit seconds (00-61)
          S: function (t) { return zeropad(t.getSeconds()); },
          // Zero-based day of the week (0-6)
          w: function (t) { return String(t.getDay()); },
          // Locale-specific date representation
          x: function (t) { return t.toLocaleDateString(); },
          // Locale-specific time representation
          X: function (t) { return t.toLocaleTimeString(); },
          // Year without century (00-99)
          y: function (t) { return zeropad(t.getFullYear() % 100); },
          // Year with century
          Y: function (t) { return String(t.getFullYear()); },
          // Timezone offset (+0000)
          Z: function (t) {
                   if (t.getTimezoneOffset() > 0) {
                       return "-" + zeropad(t.getTimezoneOffset() / 60) + "00";
                   } else {
                       return "+" + zeropad(Math.abs(t.getTimezoneOffset()) / 60) + "00";
                   }
               },
          // A percent sign
          "%": function (t) { return "%"; }
      };

      /**
       * Returns a string of the +date+ in the given +format+.
       */
      function strftime(date, format) {
          var regexp;
          for (var symbol in strftimeCallbacks) {
              regexp = new RegExp("%" + symbol, "g");
              format = format.replace(regexp, strftimeCallbacks[symbol](date));
          }

          return format;
      }
      function newChart(chartData, target){
        new tauCharts.Chart({
          data: chartData,
          type: 'scatterplot',
          x: 'date',
          y: 'value',
          color: 'relative_value',
          guide: {
            showAnchors: 'always',
            interpolate: "smooth-keep-extremum",
            color: {
              brewer: { higher: '#28a745', lower: '#dc3545', similar: '#17a2b8' }
            }
          },
          plugins: [
            tauCharts.api.plugins.get('tooltip')()
          ]
        }).renderTo('#'+target);
      }
      function genContentCharts(parsed, content_type){
        count = []
        author_count = []
        admin_deleted_count = []
        admin_deleted_time = []
        admin_karma_deletion = []
        author_deleted_count = []
        author_deleted_time = []
        author_karma_deletion = []
        $.each(parsed["data"], function (index, value){
          var date = new Date(value[0]*1000);
          date_str = strftime(date, "%Y-%m-%d %H:%M")
          observed = value[1]["observation"]["content"]["stats"][content_type]
          reference = []
          $.each(value[1]["reference"]["prev_month"], function (i_index, i_value){
            reference.push(i_value["content"]["stats"][content_type])
          })
          count.push(dataPointWithReference(observed, reference, "count", date))
          author_count.push(dataPointWithReference(observed, reference, "distinct_count", date))
          admin_deleted_count.push(dataPointWithReference(observed, reference, "admin_deleted_count", date))
          admin_deleted_time.push(dataPointWithReference(observed, reference, "admin_deleted_time", date))
          admin_karma_deletion.push(dataPointWithReference(observed, reference, "admin_karma_deletion", date))
          author_deleted_count.push(dataPointWithReference(observed, reference, "author_deleted_count", date))
          author_deleted_time.push(dataPointWithReference(observed, reference, "author_deleted_time", date))
          author_karma_deletion.push(dataPointWithReference(observed, reference, "author_karma_deletion", date))
        })
        newChart(count, content_type+"_count")
        newChart(author_count, content_type+"_author_count")
        newChart(admin_deleted_count, content_type+"_admin_deleted_count")
        newChart(admin_deleted_time, content_type+"_admin_deleted_time")
        newChart(admin_karma_deletion, content_type+"_admin_karma_deletion")
        newChart(author_deleted_count, content_type+"_author_deleted_count")
        newChart(author_deleted_time, content_type+"_author_deleted_time")
        newChart(author_karma_deletion, content_type+"_author_karma_deletion")
      }
        $.get("/api/long_term_trends.json", function(data, status){
          parsed = jQuery.parseJSON(data);
          g = 1
        });
        
      })
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h1>The Donald Monitor</h1>
          <p>Monitoring the evolution of the Donald Subreddit</p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-12">
              <h3>Comments</h3>
            </div>
            <div class="col-md-12">
              <h4>Count</h4>
              <div id="comments_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Author Count</h4>
              <div id="comments_author_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Number of Admin deletions</h4>
              <div id="comments_admin_deleted_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Amount of time before Admin deletions</h4>
              <div id="comments_admin_deleted_time" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Net Karma of Admin deletions</h4>
              <div id="comments_admin_karma_deletion" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Number of User deletions</h4>
              <div id="comments_author_deleted_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Amount of time before User deletions</h4>
              <div id="comments_author_deleted_time" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Net Karma of User deletions</h4>
              <div id="comments_author_karma_deletion" class="c chart">
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-12">
              <h3>Submissions</h3>
            </div>
            <div class="col-md-12">
              <h4>Count</h4>
              <div id="submissions_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Author Count</h4>
              <div id="submissions_author_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Number of Admin deletions</h4>
              <div id="submissions_admin_deleted_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Amount of time before Admin deletions</h4>
              <div id="submissions_admin_deleted_time" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Net Karma of Admin deletions</h4>
              <div id="submissions_admin_karma_deletion" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Number of User deletions</h4>
              <div id="submissions_author_deleted_count" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Amount of time before User deletions</h4>
              <div id="submissions_author_deleted_time" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Net Karma of User deletions</h4>
              <div id="submissions_author_karma_deletion" class="c chart">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-12">
              <h3>Domains Shared</h3>
              <p>What types of domains are users linking to?</p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Post counts by link type</h4>
              <div id="domain_shared_map" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Comment counts by link type</h4>
              <div id="domain_shared_map_comment_scaled" class="c chart">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Karma counts by link type</h4>
              <div id="domain_shared_map_karma_scaled" class="c chart">
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-12">
              <h3>Subscriber Activity</h3>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>Online users</h4>
              <div id="active_count" class="c chart">
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h4>New Subscribers per hour</h4>
              <div id="subscriber_counts" class="c chart">
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-12">
              <h3>API</h3>
              <h5>Report Data</h5>
              <p><b>/api/latest/:content_type/reduced.json?distance=:distance</b> Get only descriptive statistics for latest report - reports are generated every ten minutes.</p> 
              <p><b>/api/latest/:content_type/full.json?distance=:distance</b>  Get descriptive statistics and raw comments/submissions for latest report - reports are generated every ten minutes.</p>
              <p><b>/api/:timestamp/:content_type/reduced.json?distance=:distance</b> Get only descriptive statistics for report closest to provided epoch timestamp - reports are generated every ten minutes.</p>
              <p><b>/api/:timestamp/:content_type/full.json?distance=:distance</b> Get descriptive statistics and raw comments/submissions for report closest to provided epoch timestamp - reports are generated every ten minutes.</p>
              <p><b>/api/:timestamp/:content_type/full.json?distance=:distance</b> Get descriptive statistics and raw comments/submissions for report closest to provided epoch timestamp - reports are generated every ten minutes.</p>
              <h5>Raw Data</h5>
              <p><b>/api/:model/:start_time.json</b> Return first 100 objects created after :start_time epoch timestamp. First object is oldest, last is newest. valid :model's are "submissions", "comments", or "subscribers".</p>
              <h4>Options</h4>
              <p><b>:content_type</b>: Can be "comments", "submissions", "subscribers", or "domains"</p>
              <p><b>:timestamp</b>: Can be any epoch timestamp such as <%= Time.now.utc.to_i %> to represent <%= Time.now.utc %>. Note that data before April 2018 was not collected live, so tables may be less representative.</p>
              <p><b>:distance</b>: Integer, distance in days for how far back the window of viewing should be.</p>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>